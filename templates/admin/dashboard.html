<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; display: flex; background-color: var(--bg-light, #f0f2f5); }
        .main-content { flex-grow: 1; display: flex; flex-direction: column; }
        .content-wrapper { padding: 2em 30px; }
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 2em; }
        .card { background-color: var(--bg-white, #fff); padding: 25px; border-radius: var(--radius-lg, 8px); box-shadow: var(--shadow-md, 0 2px 4px rgba(0,0,0,0.05)); }
                .card h3 { margin: 0 0 10px 0; color: var(--text-muted, #6c757d); font-size: 1em; text-transform: uppercase; }
        .card .value { font-size: 2.2em; font-weight: bold; color: var(--text-dark, #111827); }
        
        /* New Dashboard Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: auto;
            gap: 20px;
            margin-top: 2em;
        }
        .grid-item {
            background-color: var(--bg-white, #fff);
            padding: 25px;
            border-radius: var(--radius-lg, 8px);
            box-shadow: var(--shadow-md, 0 2px 4px rgba(0,0,0,0.05));
        }
                .grid-item h2 {
            margin: 0 0 20px 0;
            font-size: 1.2em;
            color: var(--text-dark, #111827);
        }
        .sales-report-container {
            grid-column: 1 / 3; /* Span first 2 columns */
        }
        .top-products-container {
            grid-column: 3 / 4; /* Take the last column */
        }
        .recent-orders-container {
            grid-column: 1 / 4; /* Span all 3 columns */
        }

        
        .top-products-container {
            grid-column: 3 / 4; /* Take the last column */
        }

        /* Table and List Styles */
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color, #ddd); }
        th { background-color: var(--bg-light, #f8f9fa); font-size: 0.9em; color: var(--text-muted, #6c757d); }
        tbody tr:last-child td { border-bottom: none; }
        .status { padding: 5px 10px; border-radius: 15px; font-size: 0.8em; text-transform: capitalize; }
        .status-completed { background-color: #d1fae5; color: #065f46; }
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-shipped { background-color: #dbeafe; color: #1e40af; }
        .status-cancelled { background-color: #fee2e2; color: #991b1b; }
        .status-processing { background-color: #e0e7ff; color: #3730a3; }
        .list { list-style: none; padding: 0; margin: 0; }
        .list li { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color, #eee); }
        .list li:last-child { border-bottom: none; }
        .list li span { color: #374151; }
        .list li strong { font-weight: 600; color: var(--text-dark); }

        /* Report Header */
        .report-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .report-filters .btn { background: none; border: 1px solid var(--border-color); padding: 8px 12px; border-radius: var(--radius-md); cursor: pointer; text-decoration: none; color: var(--text-muted); font-size: 0.9em; }
        .report-filters .btn.active { background-color: var(--primary-light); color: var(--primary-color); border-color: var(--primary-color); font-weight: 600; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
    {% include 'admin/partials/sidebar.html' %}
    <div class="main-content">
        {% include 'admin/partials/header.html' %}
        <main class="content-wrapper">
            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="card">
                    <h3>Total Revenue</h3>
                    <p class="value">P{{ "{:,.2f}".format(data.total_revenue) }}</p>
                </div>
                <div class="card">
                    <h3>Total Orders</h3>
                    <p class="value">{{ data.total_orders }}</p>
                </div>
                <div class="card">
                    <h3>Total Customers</h3>
                    <p class="value">{{ data.total_customers }}</p>
                </div>
                <div class="card">
                    <h3>Total Products</h3>
                    <p class="value">{{ data.total_products }}</p>
                </div>
            </div>

           <!-- Main Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Sales Report Section -->
                <div class="grid-item sales-report-container">
                    <div class="report-header">
                        <h2>Sales Report</h2>
                        <div class="report-filters">
                            <a href="{{ url_for('dashboard', period='daily') }}" class="btn {{ 'active' if period == 'daily' else '' }}">Daily</a>
                            <a href="{{ url_for('dashboard', period='weekly') }}" class="btn {{ 'active' if period == 'weekly' else '' }}">Weekly</a>
                            <a href="{{ url_for('dashboard', period='monthly') }}" class="btn {{ 'active' if period == 'monthly' else '' }}">Monthly</a>
                        </div>
                    </div>
                    <div>
                        {% if data.sales_report_data %}
                        <canvas id="salesChart" style="height: 300px;"></canvas>
                        {% else %}
                        <div style="text-align: center; padding: 40px; color: #6c757d; height: 300px; display: flex; align-items: center; justify-content: center;">
                            <p>No sales data available for the selected period.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Top Selling Products Section -->
                <div class="grid-item top-products-container">
                    <h2>Top Selling Products</h2>
                    <ul class="list">
                        {% for product in data.top_selling_products %}
                        <li>
                            <span>{{ product.name }}</span>
                            <strong>{{ product.total_sold }} sold</strong>
                        </li>
                        {% else %}
                        <li style="justify-content: center; padding: 20px;">No sales data available.</li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Recent Orders Section -->
                <div class="grid-item recent-orders-container">
                    <h2>Recent Orders</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in data.recent_orders %}
                            <tr>
                                <td>#{{ order.id }}</td>
                                <td>{{ order.customer_name }}</td>
                                <td>P{{ "{:,.2f}".format(order.totalamount) }}</td>
                                <td><span class="status status-{{ order.status }}">{{ order.status }}</span></td>
                                <td>{{ order.createdat.strftime('%Y-%m-%d') }}</td>
                            </tr>
                            {% else %}
                            <tr><td colspan="5" style="text-align: center; padding: 20px;">No recent orders found.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
        <script>

        document.addEventListener('DOMContentLoaded', function () {
            const ctx = document.getElementById('salesChart').getContext('2d');
            const salesData = {{ data.sales_report_data|tojson }};

            const labels = salesData.map(d => d.date_period);
            const sales = salesData.map(d => d.total_sales);

            new Chart(ctx, {
                type: 'bar',  
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total Sales (₱)',
                        data: sales,
                        backgroundColor: 'rgba(16, 185, 129, 0.6)',
                        borderColor: '#10b981',
                        borderWidth: 1,
                        borderRadius: 6,
                        maxBarThickness: 40
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '{{ "Day" if period == "daily" else ("Week" if period == "weekly" else "Month") }}',
                                color: '#6b7280',
                                font: { size: 12 }
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(148, 163, 184, 0.15)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '₱' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let value = context.parsed.y || 0;
                                    return '₱' + value.toLocaleString(undefined, {
                                        minimumFractionDigits: 2,
                                        maximumFractionDigits: 2
                                    });
                                }
                            }
                        }
                    }
                }
            });
        });
        
    </script>
</body>
</html>