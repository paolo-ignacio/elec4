<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; display: flex; background-color: var(--bg-light, #f0f2f5); }
        .main-content { flex-grow: 1; display: flex; flex-direction: column; }
        .content-wrapper { padding: 2em 30px; }
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 2em; }
        .card { background-color: var(--bg-white, #fff); padding: 25px; border-radius: var(--radius-lg, 8px); box-shadow: var(--shadow-md, 0 2px 4px rgba(0,0,0,0.05)); }
                .card h3 { margin: 0 0 10px 0; color: var(--text-muted, #6c757d); font-size: 1em; text-transform: uppercase; }
        .card .value { font-size: 2.2em; font-weight: bold; color: var(--text-dark, #111827); }
        
        /* New Dashboard Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: auto;
            gap: 20px;
            margin-top: 2em;
        }
        .grid-item {
            background-color: var(--bg-white, #fff);
            padding: 25px;
            border-radius: var(--radius-lg, 8px);
            box-shadow: var(--shadow-md, 0 2px 4px rgba(0,0,0,0.05));
        }
                .grid-item h2 {
            margin: 0 0 20px 0;
            font-size: 1.2em;
            color: var(--text-dark, #111827);
        }
        .sales-report-container {
            grid-column: 1 / 3; /* Span first 2 columns */
        }
        .top-products-container {
            grid-column: 3 / 4; /* Take the last column */
        }
        .recent-orders-container {
            grid-column: 1 / 4; /* Span all 3 columns */
        }

        
        .top-products-container {
            grid-column: 3 / 4; /* Take the last column */
        }

        /* Table and List Styles */
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color, #ddd); }
        th { background-color: var(--bg-light, #f8f9fa); font-size: 0.9em; color: var(--text-muted, #6c757d); }
        tbody tr:last-child td { border-bottom: none; }
        .status { padding: 5px 10px; border-radius: 15px; font-size: 0.8em; text-transform: capitalize; }
        .status-completed { background-color: #d1fae5; color: #065f46; }
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-shipped { background-color: #dbeafe; color: #1e40af; }
        .status-cancelled { background-color: #fee2e2; color: #991b1b; }
        .status-processing { background-color: #e0e7ff; color: #3730a3; }
        .list { list-style: none; padding: 0; margin: 0; }
        .list li { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color, #eee); }
        .list li:last-child { border-bottom: none; }
        .list li span { color: #374151; }
        .list li strong { font-weight: 600; color: var(--text-dark); }

        /* Report Header */
        .report-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px; }
        .report-header-left { display: flex; flex-direction: column; gap: 4px; }
        .report-header-left h2 { margin: 0; }
        .report-period-info { font-size: 0.85em; color: var(--text-muted, #6c757d); font-weight: 400; }
        .report-filters { display: flex; gap: 8px; }
        .report-filters .btn { background: none; border: 1px solid var(--border-color, #e5e7eb); padding: 8px 16px; border-radius: var(--radius-md, 6px); cursor: pointer; text-decoration: none; color: var(--text-muted, #6c757d); font-size: 0.9em; transition: all 0.2s ease; }
        .report-filters .btn:hover { background-color: var(--bg-light, #f8f9fa); border-color: #d1d5db; }
        .report-filters .btn.active { background-color: #ecfdf5; color: #059669; border-color: #10b981; font-weight: 600; }

        /* Chart Summary */
        .chart-summary { display: flex; gap: 30px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color, #e5e7eb); }
        .chart-summary-item { display: flex; flex-direction: column; gap: 2px; }
        .chart-summary-label { font-size: 0.75em; color: var(--text-muted, #6c757d); text-transform: uppercase; letter-spacing: 0.5px; }
        .chart-summary-value { font-size: 1.3em; font-weight: 700; color: var(--text-dark, #111827); }
        .chart-summary-value.positive { color: #059669; }

        /* Chart Container */
        .chart-container { position: relative; height: 280px; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
    {% include 'admin/partials/sidebar.html' %}
    <div class="main-content">
        {% include 'admin/partials/header.html' %}
        <main class="content-wrapper">
            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="card">
                    <h3>Total Revenue</h3>
                    <p class="value">P{{ "{:,.2f}".format(data.total_revenue) }}</p>
                </div>
                <div class="card">
                    <h3>Total Orders</h3>
                    <p class="value">{{ data.total_orders }}</p>
                </div>
                <div class="card">
                    <h3>Total Customers</h3>
                    <p class="value">{{ data.total_customers }}</p>
                </div>
                <div class="card">
                    <h3>Total Products</h3>
                    <p class="value">{{ data.total_products }}</p>
                </div>
            </div>

           <!-- Main Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Sales Report Section -->
                <div class="grid-item sales-report-container">
                    <div class="report-header">
                        <div class="report-header-left">
                            <h2>Sales Report</h2>
                            <span class="report-period-info">
                                {% if period == 'daily' %}
                                    Current Week (Mon - Sun)
                                {% elif period == 'weekly' %}
                                    {{ period_info.current_month }} (Weeks of the Month)
                                {% else %}
                                    Year {{ period_info.current_year }} (Jan - Dec)
                                {% endif %}
                            </span>
                        </div>
                        <div class="report-filters">
                            <a href="{{ url_for('dashboard', period='daily') }}" class="btn {{ 'active' if period == 'daily' else '' }}">Daily</a>
                            <a href="{{ url_for('dashboard', period='weekly') }}" class="btn {{ 'active' if period == 'weekly' else '' }}">Weekly</a>
                            <a href="{{ url_for('dashboard', period='monthly') }}" class="btn {{ 'active' if period == 'monthly' else '' }}">Monthly</a>
                        </div>
                    </div>
                    <!-- Chart Summary -->
                    <div class="chart-summary">
                        <div class="chart-summary-item">
                            <span class="chart-summary-label">Total Sales</span>
                            <span class="chart-summary-value positive">₱{{ "{:,.2f}".format(data.sales_report_data.total_sales) }}</span>
                        </div>
                        <div class="chart-summary-item">
                            <span class="chart-summary-label">Average</span>
                            <span class="chart-summary-value">₱{{ "{:,.2f}".format(data.sales_report_data.avg_sales) }}</span>
                        </div>
                        <div class="chart-summary-item">
                            <span class="chart-summary-label">Orders</span>
                            <span class="chart-summary-value">{{ data.sales_report_data.total_orders }}</span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>

                <!-- Top Selling Products Section -->
                <div class="grid-item top-products-container">
                    <h2>Top Selling Products</h2>
                    <ul class="list">
                        {% for product in data.top_selling_products %}
                        <li>
                            <span>{{ product.name }}</span>
                            <strong>{{ product.total_sold }} sold</strong>
                        </li>
                        {% else %}
                        <li style="justify-content: center; padding: 20px;">No sales data available.</li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Recent Orders Section -->
                <div class="grid-item recent-orders-container">
                    <h2>Recent Orders</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in data.recent_orders %}
                            <tr>
                                <td>#{{ order.id }}</td>
                                <td>{{ order.customer_name }}</td>
                                <td>P{{ "{:,.2f}".format(order.totalamount) }}</td>
                                <td><span class="status status-{{ order.status }}">{{ order.status }}</span></td>
                                <td>{{ order.createdat.strftime('%Y-%m-%d') }}</td>
                            </tr>
                            {% else %}
                            <tr><td colspan="5" style="text-align: center; padding: 20px;">No recent orders found.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const chartCanvas = document.getElementById('salesChart');
            if (!chartCanvas) return;

            const ctx = chartCanvas.getContext('2d');

            // Data from Flask - pure server-side rendering
            const chartLabels = {{ data.sales_report_data.labels|tojson }};
            const chartData = {{ data.sales_report_data.data|tojson }};

            // Create gradient for bars
            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, 'rgba(16, 185, 129, 0.8)');
            gradient.addColorStop(1, 'rgba(16, 185, 129, 0.3)');

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Sales',
                        data: chartData,
                        backgroundColor: gradient,
                        borderColor: '#10b981',
                        borderWidth: 1,
                        borderRadius: 6,
                        borderSkipped: false,
                        maxBarThickness: 50
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: { size: 12, weight: '500' }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: { size: 11 },
                                callback: function(value) {
                                    if (value >= 1000) {
                                        return '₱' + (value / 1000).toFixed(0) + 'k';
                                    }
                                    return '₱' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(17, 24, 39, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            padding: 12,
                            cornerRadius: 8,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    let value = context.parsed.y || 0;
                                    return 'Sales: ₱' + value.toLocaleString(undefined, {
                                        minimumFractionDigits: 2,
                                        maximumFractionDigits: 2
                                    });
                                }
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>